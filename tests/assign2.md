---
title: "Assign 2:"
layout: page
parent: Assignments
---
# Assign 2

```sql
-- Step 1: 创建数据库`library`

CREATE DATABASE library ON
(NAME = library_dat,
	FILENAME = 'E:\db\LibraryData\librarydt.mdf',
	SIZE = 10,
	MAXSIZE = 50,
	FILEGROWTH = 5)
LOG ON
(NAME = library_log,
	FILENAME = 'E:\db\LibraryData\librarylog.mdf',
	SIZE = 5 MB,
	MAXSIZE = 25 MB,
	FILEGROWTH = 5 MB);
GO

-- Step 2: 创建表

USE library;
GO

-- 1. 创建图书表
CREATE TABLE [图书] (
    [图书编号] VARCHAR(10) PRIMARY KEY,
    [书名] NVARCHAR(50),
    [类别] NVARCHAR(20),
    [出版社] NVARCHAR(50),
    [作者] NVARCHAR(50),
    [定价] DECIMAL(5, 2),
    [出版日期] DATE
);

-- 2. 创建读者类型表
CREATE TABLE [读者类型] (
    [类型编号] INT PRIMARY KEY,
    [类型名称] NVARCHAR(20),
    [限借数量] INT,
    [借阅期限] INT
);

-- 3. 创建读者表，包含外键约束
CREATE TABLE [读者] (
    [读者编号] INT PRIMARY KEY,
    [姓名] NVARCHAR(20),
    [性别] NVARCHAR(10),
    [单位] NVARCHAR(50),
    [电话] NVARCHAR(20),
    [读者类型] INT,
    [已借数量] INT,
    FOREIGN KEY ([读者类型]) REFERENCES [读者类型]([类型编号])
);

-- 4. 创建借阅记录表，包含外键约束
CREATE TABLE [借阅记录] (
    [串号] INT PRIMARY KEY,
    [读者编号] INT,
    [图书编号] VARCHAR(10),
    [借书日期] DATE,
    [还书日期] DATE,
    FOREIGN KEY ([读者编号]) REFERENCES [读者]([读者编号]),
    FOREIGN KEY ([图书编号]) REFERENCES [图书]([图书编号])
);

-- Step 3: 插入数据

USE library;
GO

-- 1. 插入数据到图书表
INSERT INTO [图书] ([图书编号], [书名], [类别], [出版社], [作者], [定价], [出版日期])
VALUES 
    ('TP0001', '数据结构', '计算机', '机械工业出版社', '敬一明', 50.00, NULL),
    ('TP0002', '计算机应用基础', '计算机', '高等教育出版社', '杨正东', 20.00, NULL),
    ('TP0013', 'SQL Server 2000', '计算机', '大连理工出版社', '叶潮流', 30.00, '2010-01-01'),
    ('TP0004', 'C语言程序设计', '计算机', '清华大学出版社', '谭浩强', 25.00, NULL),
    ('H31001', '实用英语精读', '英语', '中国人大出版社', '张锦芯', 25.00, NULL),
    ('F27505', '管理学概论', '管理', '高等教育出版社', '李道芳', 35.00, '2011-11-01'),
    ('TB0004', '工业管理', '管理', '机械工业出版社', 'Fayol', 70.00, NULL),
    ('O15005', '线性代数', '数学', '机械工业出版社', '李京平', 50.00, NULL),
    ('FO0006', '电子商务', '管理', '机械工业出版社', 'Durark', 14.00, NULL),
    ('TP0038', 'ASP程序设计', '计算机', '水利水电出版社', '叶潮流', 29.00, '2008-10-01');

-- 2. 插入数据到读者类型表
INSERT INTO [读者类型] ([类型编号], [类型名称], [限借数量], [借阅期限])
VALUES 
    (1, '教师', 20, 180),
    (2, '学生', 10, 90);

-- 3. 插入数据到读者表
INSERT INTO [读者] ([读者编号], [姓名], [性别], [单位], [电话], [读者类型], [已借数量])
VALUES 
    (1001, '刘春华', '男', '管理学院', '81234567', 1, NULL),
    (1002, '王新刚', '男', '经济学院', '13829023456', 2, NULL),
    (1003, '何立锋', '女', '管理学院', '13805514067', 2, NULL),
    (1004, '王永平', '男', '文学院', '13908423456', 1, NULL),
    (1005, '周士杰', '女', '教育学院', '13105654567', 1, NULL),
    (1006, '庞丽萍', '男', '数理学院', '1380551****', 1, NULL),
    (1007, '张涵韵', '女', '艺术学院', '1860551****', 2, NULL),
    (1008, '王晓静', '男', '电子学院', '1332901****', 1, NULL),
    (1009, '罗国明', '女', '电子学院', '1320565****', 2, NULL),
    (1010, '李春刚', '男', '机电学院', '1330551****', 2, NULL);

-- 4. 插入数据到借阅记录表
INSERT INTO [借阅记录] ([串号], [读者编号], [图书编号], [借书日期], [还书日期])
VALUES 
    (1, 1001, 'TP0001', '2011-10-08', '2011-12-18'),
    (2, 1001, 'TP0002', '2011-10-08', '2011-12-18'),
    (3, 1003, 'TP0013', '2011-09-01', NULL),
    (4, 1004, 'TP0001', '2011-10-26', NULL),
    (5, 1005, 'H31001', '2011-11-23', NULL),
    (6, 1006, 'F27505', '2011-09-18', NULL),
    (7, 1001, 'TB0004', '2010-05-18', NULL),
    (8, 1005, 'O15005', '2012-01-15', NULL),
    (9, 1009, 'FO0006', '2012-01-08', NULL),
    (10, 1006, 'TP0038', '2011-12-20', NULL);
```

## 第1步：创建数据库

- 数据库名：`library`

```sql
-- Step 1: 创建数据库`library`

CREATE DATABASE library ON
(NAME = library_dat,
	FILENAME = 'E:\db\LibraryData\librarydt.mdf',
	SIZE = 10,
	MAXSIZE = 50,
	FILEGROWTH = 5)
LOG ON
(NAME = library_log,
	FILENAME = 'E:\db\LibraryData\librarylog.mdf',
	SIZE = 5 MB,
	MAXSIZE = 25 MB,
	FILEGROWTH = 5 MB);
GO
```

- [Create a database](https://learn.microsoft.com/en-us/sql/relational-databases/databases/create-a-database?view=sql-server-ver16)

## 第2步：创建表 & 插入数据

```sql
-- Step 2: 创建表

USE library;
GO

-- 1. 创建图书表
CREATE TABLE [图书] (
    [图书编号] VARCHAR(10) PRIMARY KEY,
    [书名] NVARCHAR(50),
    [类别] NVARCHAR(20),
    [出版社] NVARCHAR(50),
    [作者] NVARCHAR(50),
    [定价] DECIMAL(5, 2),
    [出版日期] DATE
);

-- 2. 创建读者类型表
CREATE TABLE [读者类型] (
    [类型编号] INT PRIMARY KEY,
    [类型名称] NVARCHAR(20),
    [限借数量] INT,
    [借阅期限] INT
);

-- 3. 创建读者表，包含外键约束
CREATE TABLE [读者] (
    [读者编号] INT PRIMARY KEY,
    [姓名] NVARCHAR(20),
    [性别] NVARCHAR(10),
    [单位] NVARCHAR(50),
    [电话] NVARCHAR(20),
    [读者类型] INT,
    [已借数量] INT,
    FOREIGN KEY ([读者类型]) REFERENCES [读者类型]([类型编号])
);

-- 4. 创建借阅记录表，包含外键约束
CREATE TABLE [借阅记录] (
    [串号] INT PRIMARY KEY,
    [读者编号] INT,
    [图书编号] VARCHAR(10),
    [借书日期] DATE,
    [还书日期] DATE,
    FOREIGN KEY ([读者编号]) REFERENCES [读者]([读者编号]),
    FOREIGN KEY ([图书编号]) REFERENCES [图书]([图书编号])
);
```

- [USE (Transact-SQL)](https://learn.microsoft.com/en-us/sql/t-sql/language-elements/use-transact-sql?view=sql-server-ver16)

###  1. 图书表

| 图书编号   | 书名              | 类别  | 出版社     | 作者     | 定价  | 出版日期    |
| ------ | --------------- | --- | ------- | ------ | --- | ------- |
| TP0001 | 数据结构            | 计算机 | 机械工业出版社 | 敬一明    | 50  |         |
| TP0002 | 计算机应用基础         | 计算机 | 高等教育出版社 | 杨正东    | 20  |         |
| TP0013 | SQL Server 2000 | 计算机 | 大连理工出版社 | 叶潮流    | 30  | 2010.01 |
| TP0004 | C语言程序设计         | 计算机 | 清华大学出版社 | 谭浩强    | 25  |         |
| H31001 | 实用英语精读          | 英语  | 中国人大出版社 | 张锦芯    | 25  |         |
| F27505 | 管理学概论           | 管理  | 高等教育出版社 | 李道芳    | 35  | 2011.11 |
| TB0004 | 工业管理            | 管理  | 机械工业出版社 | Fayol  | 70  |         |
| O15005 | 线性代数            | 数学  | 机械工业出版社 | 李京平    | 50  |         |
| FO0006 | 电子商务            | 管理  | 机械工业出版社 | Durark | 14  |         |
| TP0038 | ASP程序设计         | 计算机 | 水利水电出版社 | 叶潮流    | 29  | 2008.10 |

```sql
-- 1. 创建图书表
CREATE TABLE [图书] (
    [图书编号] VARCHAR(10) PRIMARY KEY,
    [书名] NVARCHAR(50),
    [类别] NVARCHAR(20),
    [出版社] NVARCHAR(50),
    [作者] NVARCHAR(50),
    [定价] DECIMAL(5, 2),
    [出版日期] DATE
);
```

### 2. 读者类型表

| 类型编号 | 类型名称 | 限借数量 | 借阅期限 |
| ---- | ---- | ---- | ---- |
| 1    | 教师   | 20   | 180  |
| 2    | 学生   | 10   | 90   |
```sql
-- 2. 创建读者类型表
CREATE TABLE [读者类型] (
    [类型编号] INT PRIMARY KEY,
    [类型名称] NVARCHAR(20),
    [限借数量] INT,
    [借阅期限] INT
);
```

### 3. 读者表

| 读者编号 | 姓名  | 性别  | 单位   | 电话          | 读者类型 | 已借数量 |
| ---- | --- | --- | ---- | ----------- | ---- | ---- |
| 1001 | 刘春华 | 男   | 管理学院 | 81234567    | 1    |      |
| 1002 | 王新刚 | 男   | 经济学院 | 13829023456 | 2    |      |
| 1003 | 何立锋 | 女   | 管理学院 | 13805514067 | 2    |      |
| 1004 | 王永平 | 男   | 文学院  | 13908423456 | 1    |      |
| 1005 | 周士杰 | 女   | 教育学院 | 13105654567 | 1    |      |
| 1006 | 庞丽萍 | 男   | 数理学院 | 1380551**** | 1    |      |
| 1007 | 张涵韵 | 女   | 艺术学院 | 1860551**** | 2    |      |
| 1008 | 王晓静 | 男   | 电子学院 | 1332901**** | 1    |      |
| 1009 | 罗国明 | 女   | 电子学院 | 1320565**** | 2    |      |
| 1010 | 李春刚 | 男   | 机电学院 | 1330551**** | 2    |      |

```sql
-- 3. 创建读者表，包含外键约束
CREATE TABLE [读者] (
    [读者编号] INT PRIMARY KEY,
    [姓名] NVARCHAR(20),
    [性别] NVARCHAR(10),
    [单位] NVARCHAR(50),
    [电话] NVARCHAR(20),
    [读者类型] INT,
    [已借数量] INT,
    FOREIGN KEY ([读者类型]) REFERENCES [读者类型]([类型编号])
);
```

### 4. 借阅记录表

| 串号  | 读者编号 | 图书编号   | 借书日期       | 还书日期       |
| --- | ---- | ------ | ---------- | ---------- |
| 1   | 1001 | TP0001 | 2011-10-08 | 2011-12-18 |
| 2   | 1001 | TP0002 | 2011-10-08 | 2011-12-18 |
| 3   | 1003 | TP0013 | 2011-9-1   |            |
| 4   | 1004 | TP0001 | 2011-10-26 |            |
| 5   | 1005 | H31001 | 2011-11-23 |            |
| 6   | 1006 | F27505 | 2011-9-18  |            |
| 7   | 1001 | TB0004 | 2010-5-18  |            |
| 8   | 1005 | O15005 | 2012-1--15 |            |
| 9   | 1009 | FO0006 | 2012-1-8   |            |
| 10  | 1006 | TP0038 | 2011-12-20 |            |

```sql
-- 4. 创建借阅记录表，包含外键约束
CREATE TABLE [借阅记录] (
    [串号] INT PRIMARY KEY,
    [读者编号] INT,
    [图书编号] VARCHAR(10),
    [借书日期] DATE,
    [还书日期] DATE,
    FOREIGN KEY ([读者编号]) REFERENCES [读者]([读者编号]),
    FOREIGN KEY ([图书编号]) REFERENCES [图书]([图书编号])
);
```

## 第3步：插入数据

```sql
-- Step 3: 插入数据

USE library;
GO

-- 1. 插入数据到图书表
INSERT INTO [图书] ([图书编号], [书名], [类别], [出版社], [作者], [定价], [出版日期])
VALUES 
    ('TP0001', '数据结构', '计算机', '机械工业出版社', '敬一明', 50.00, NULL),
    ('TP0002', '计算机应用基础', '计算机', '高等教育出版社', '杨正东', 20.00, NULL),
    ('TP0013', 'SQL Server 2000', '计算机', '大连理工出版社', '叶潮流', 30.00, '2010-01-01'),
    ('TP0004', 'C语言程序设计', '计算机', '清华大学出版社', '谭浩强', 25.00, NULL),
    ('H31001', '实用英语精读', '英语', '中国人大出版社', '张锦芯', 25.00, NULL),
    ('F27505', '管理学概论', '管理', '高等教育出版社', '李道芳', 35.00, '2011-11-01'),
    ('TB0004', '工业管理', '管理', '机械工业出版社', 'Fayol', 70.00, NULL),
    ('O15005', '线性代数', '数学', '机械工业出版社', '李京平', 50.00, NULL),
    ('FO0006', '电子商务', '管理', '机械工业出版社', 'Durark', 14.00, NULL),
    ('TP0038', 'ASP程序设计', '计算机', '水利水电出版社', '叶潮流', 29.00, '2008-10-01');

-- 2. 插入数据到读者类型表
INSERT INTO [读者类型] ([类型编号], [类型名称], [限借数量], [借阅期限])
VALUES 
    (1, '教师', 20, 180),
    (2, '学生', 10, 90);

-- 3. 插入数据到读者表
INSERT INTO [读者] ([读者编号], [姓名], [性别], [单位], [电话], [读者类型], [已借数量])
VALUES 
    (1001, '刘春华', '男', '管理学院', '81234567', 1, NULL),
    (1002, '王新刚', '男', '经济学院', '13829023456', 2, NULL),
    (1003, '何立锋', '女', '管理学院', '13805514067', 2, NULL),
    (1004, '王永平', '男', '文学院', '13908423456', 1, NULL),
    (1005, '周士杰', '女', '教育学院', '13105654567', 1, NULL),
    (1006, '庞丽萍', '男', '数理学院', '1380551****', 1, NULL),
    (1007, '张涵韵', '女', '艺术学院', '1860551****', 2, NULL),
    (1008, '王晓静', '男', '电子学院', '1332901****', 1, NULL),
    (1009, '罗国明', '女', '电子学院', '1320565****', 2, NULL),
    (1010, '李春刚', '男', '机电学院', '1330551****', 2, NULL);

-- 4. 插入数据到借阅记录表
INSERT INTO [借阅记录] ([串号], [读者编号], [图书编号], [借书日期], [还书日期])
VALUES 
    (1, 1001, 'TP0001', '2011-10-08', '2011-12-18'),
    (2, 1001, 'TP0002', '2011-10-08', '2011-12-18'),
    (3, 1003, 'TP0013', '2011-09-01', NULL),
    (4, 1004, 'TP0001', '2011-10-26', NULL),
    (5, 1005, 'H31001', '2011-11-23', NULL),
    (6, 1006, 'F27505', '2011-09-18', NULL),
    (7, 1001, 'TB0004', '2010-05-18', NULL),
    (8, 1005, 'O15005', '2012-01-15', NULL),
    (9, 1009, 'FO0006', '2012-01-08', NULL),
    (10, 1006, 'TP0038', '2011-12-20', NULL);
```

## 第4步：查询数据

1. 查询图书表中书名中包含“程序设计”的图书信息。
2. 查询图书表中“计算机”类别的图书信息，输出结果按出版日期降序排列。
3. 查询图书定价最高的前3个图书的图书编号、书名、定价。
4. 查询各读者在2021-10-1到2022-10-1之间的借阅数量（不能利用读者表的列“已借数量”）。
5. 查询借阅图书次数超过2次的读者编号、借阅数量（不能利用读者表的列“已借数量”）。
6. 使用连接查询，查询“C语言程序设计”图书借阅日期最近的3名读者的读者编号和借书日期。
7. 使用连接查询，查询2021-10-1到2022-10-1之间作者为“谭浩强”的图书的借阅情况。
8. 使用连接查询，查询借阅了《数据结构》图书的读者信息。
9. 使用嵌套查询，查询借阅图书的读者信息。
10. 使用嵌套查询，查询作者所著图书的平均定价大于所有图书的平均定价的作者。

```sql
USE library;
GO

-- Q1
SELECT *
FROM 图书
WHERE 书名 LIKE '%程序设计%';

-- Q2
SELECT *
FROM 图书
WHERE 类别 = '计算机'
ORDER BY 出版日期 DESC;

-- Q3
SELECT TOP 3 图书编号, 书名, 定价
FROM 图书
ORDER BY 定价 DESC;
```

---

Last Updated: Mon Oct 28 13:44:07 CST 2024
